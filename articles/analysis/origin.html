<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <title>初代「デジタルモンスター」の通信</title>
    <link rel="shortcut icon" type="image/x-icon" href="../../favicon.ico">
    <link rel="stylesheet" type="text/css" href="../../styles/style.css">
    <script>pagetype="analysis";path="../";</script>
    <script src="../../scripts/script.js"></script>
  </head>
  <body>
    <div class="wrapper">
      <div class="content">
	<div>
	  <h1>初代「デジタルモンスター」の通信</h1>
	  <br>
	  <span class="date">記事作成 : 2016/11/24(木)</span>
	  <span class="date">最終更新 : 2016/11/24(木)</span>
	  <hr>
	  <!-------------------- 記事内容 -------------------->
	  <h3>通信の流れ</h3>
	  <p>
	    育成ギアの通信は下の図に示すようにフレームを交互に送信することで行われます。
	    (フレームについては<a href="dlink.html">D-Link</a>を参照してください。)
	    まず、通信を開始した(真ん中のボタンを押した)側のギアが最初のフレームを送信します。
	    その直後に、相手側のギアがフレームを送信し、その後また開始した側がフレームを送信するという流れになります。
	  </p>
	  <img src="origin/trans-frame1.png">
	  <p>
	    通信時の信号波形は下のような感じです。
	    ギア1のフレーム送信が終了した直後にギア2のStartパルスが送信されています。
	  </p>
	  <img src="origin/trans-frame2.png">
	  <p>
	    D-Linkのフレームは16ビットですが初代育成ギアでは、半分を冗長ビットとして使用しています。
	    そのため1フレームで送信される情報は実質8ビットです。
	  </p>
	  <p>
	    初代育成ギアの通信では、それぞれ2フレーム送信されますが、このフレームはどちらのギアでも同じフォーマットをしています。
	    ここでは、このフォーマットをデータセットと呼ぶことにします。
	  </p>
	  <br><br>
	  <h3>冗長ビット</h3>
	  <p>
	    初代育成ギアではフレームの上位8ビットが冗長ビットとなっています。
	    この冗長ビットは下位8ビットの各ビットを反転したものです。
	    例えば、下位8ビットが"00100011"だった場合、冗長ビットはそれを反転した"11011100"となり、フレーム全体では"1101110000100011"となります。
	    ここが間違っていた場合は通信エラーとなります。
	  </p>
	  <img src="origin/redandancy-bit.png">
	  <br><br>
	  <h3>データセット</h3>
	  <p>
	    初代育成ギアのデータセットは2つのフレームで構成されます。
	    1つのフレームの半分は冗長ビットなので実際のデータは2バイトだけです。
	    このデータセットを互いに送信することで通信が行われます。
	    フレームの下位8ビットはさらに2つに分けられ、各4ビットで全部で4つのデータが送られます。
	  </p>
	  <img src="origin/origin-dataset.png">
	  <h4>【進化表位置】</h4>
	  <p>
	    デジモンの種類を特定するためのフィールドです。
	    実際にはバージョンによってデジモンが変わるので進化表位置と呼ぶことにします。
	    初代育成ギアでは、この進化表位置で強さ、相性、攻撃ドットが決定します。
	  </p>
	  <p>
	    値は下の図のように順番に割り当てられます。
	    アグモンは"0011"で、数値で言えば3になります。
	    このことからボタモンとコロモンにもそれぞれ1、2が割り当てられていることが推測されます(バトルできないんで確認はできませんが)。
	    他のバージョンについても同様に数値が割り当てられています。
	    つまり、ガブモンやパタモンも進化表位置がアグモンと同じなので"0011"となります。
	  </p>
	  <img src="origin/evo-tree.png" width="500px">
	  <h4>【努力値?】</h4>
	  <p>
	    ここはまだ正確には分かっていませんが、恐らくトレーニングやプロテインで増加した分の強さを表すフィールドだと思います。
	    何回のトレーニングで増加するか、どのくらい勝率に影響するかなどは今後解析していく予定です。
	  </p>
	  <h4>【勝敗】</h4>
	  <p>
	    バトルの勝敗を表すフィールドです。
	    勝利は"0001"で、敗北が"0010"となります。
	    通信の流れからも分かるように、ここの値は通信を開始した側が一方的に決めることができます。
	    相手側はそれに従い、勝利"0001"が送られてきたら敗北"0010"を返し、敗北"0010"が送られてきたら勝利"0001"を返します。
	    通信を開始した側が相手から送られてきた勝敗情報をどうするかは特に決まっていません。
	    初代育成ギアでは無視しますが、デジヴァイスでは相手側が送ったものに従うようです。
	  </p>
	  <h4>【バージョン】</h4>
	  <p>
	    育成ギアのバージョンを表すフィールドです。
	    値はバージョン1が"0000"、バージョン2が"0001"、バージョン3が"0010"のように増えていきます。
	    0から始まってるので、ここの値は"バージョン番号 - 1"となります、ややこしいですね。
	  </p>
	  <p>
	    ちなみに、バージョン1は、このフィールドの挙動が他のものと異なります。
	    バージョン1が通信を開始した側であるときは普通なのですが、受けた側のときは相手が送信したバージョン情報をオウム返しします。
	    例えば、バージョン1とバージョン4が対戦する場合、バージョン4が通信を開始すると、バージョン1のここのフィールドは"0011"になります。
	    なぜこのような仕様なのかは不明です。
	  </p>
	  <!-------------------- ここまで -------------------->
	  <hr>
	</div>
      </div>
    </div>
  </body>
</html>
